<canvas id="canvas2" width="100" height="100" style="image-rendering: pixelated;"></canvas>

<script>

    function randInt(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function max0(x) {
        return Math.max(0, x)
    }

    function sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }
    var canvas2 = document.getElementById('canvas2');
    var ctx2 = canvas2.getContext('2d');
    ctx2.fillStyle = "#000000"
    ctx2.fillRect(0, 0, 100, 100)

    let algae = []

    var im = ctx2.createImageData(1,1); // only do this once per page
    var d  = im.data;                        // only do this once per page
    d[0]   = 0;
    d[1]   = 250;
    d[2]   = 0;
    d[3]   = 250;
    async function render() {
        ctx2.fillRect(0, 0, 100, 100)
        algae.forEach(a => {
            ctx2.putImageData( im, a[0], a[1] );  
        })
    }

    async function move() {
        algae.forEach(a => {
            let r = Math.random()
            if (r < 0.5) {
                return
            }
            if (r < 0.625) { //move left
                a[0] = Math.max(0, a[0]-1)
                return
            }
            if (r < 0.75) { //move right
                a[0] = Math.min(99, a[0]+1)
                return
            }
            if (r < 0.875) { //move up
                a[1] = Math.max(0, a[1]-1)
                return
            }
            if (r < 0.99) { //move down
                a[1] = Math.min(99, a[1]+1)
                return
            }
            
        })
    }
    async function hej() {
        await sleep(1000)
        if (algae.length < 50) {
            let xstart = randInt(0, 99)
            let ystart = randInt(0, 99)
            let newalg = [xstart, ystart]
            algae.push(newalg)
        }
        
       console.log(algae)
        await move()
        await render()
        
    }

    async function start() {
        while(true) {
            
            await hej()
            
        }
    }
    
    start()

</script>
